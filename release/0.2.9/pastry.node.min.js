!function(a){"use strict";a=a||{};var b,c,d={},e=Array,f=Function,g=Object,h=String,i="prototype",j="undefined",k=e[i],l=f[i],m=g[i],n=h[i],o={}.toString,p=k.slice,q=function(){},r=function(a,b){return o.call(b)==="[object "+a+"]"};d.VERSION="0.2.0",d.index=function(a){return function(b,c,d){var e,f=b.length>>>0;if(0===f)return-1;if(d?0>d&&(d=Math.max(0,b.length+d)):d=0,a){for(e=d;e<b.length;e++)if(b[e]===c)return e}else for(e=d;e>=0;e--)if(b[e]===c)return e;return-1}},d.indexOf=k.indexOf?function(a,b,c){return a.indexOf(b,c)}:d.index(!0),d.lastIndexOf=k.lastIndexOf?function(a,b,c){return a.lastIndexOf(b,c)}:d.index(),d.each=d.forEach=m.forEach?function(a,b,c){a.forEach(b,c)}:function(a,b,c){for(var d in a)b.call(c,a[d],d,a)},d.eachReverse=function(a,b,c){if(a)for(var d=a.length-1;d>-1;d-=1)b.call(c,a[d],d,a)},d.every=k.every?function(a,b,c){return a.every(b,c)}:function(a,b,c){var d;for(d=0;d<a.length;d++)if(!b.call(c,a[d],d,a))return!1;return!0},d.filter=k.filter?function(a,b,c){return a.filter(b,c)}:function(a,b,c){var e=[];return d.each(a,function(d,f){b.call(c,d,f,a)&&e.push(d)}),e},d.map=k.map?function(a,b,c){return a.map(b,c)}:function(a,b,c){var e=[];return d.each(a,function(d,f){e.push(b.call(c,d,f,a))}),e},d.some=k.some?function(a,b,c){return a.some(b,c)}:function(a,b,c){var d;for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a))return!0;return!1},d.reduce=k.reduce?function(a,b,c){return c?a.reduce(b,c):a.reduce(b)}:function(a,b,c){var d,e;for(c&&(e=c),d=0;d<a.length;d++)e=e?b(e,a[d],d,a):a[d];return e},d.reduceRight=k.reduceRight?function(a,b,c){return c?a.reduceRight(b,c):a.reduceRight(b)}:function(a,b,c){var d,e;for(c&&(e=c),d=a.length-1;d>=0;d--)e=e?b(e,a[d],d,a):a[d];return e},d.trim=n.trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},d.trimLeft=n.trimLeft?function(a){return a.trimLeft()}:function(a){return a.replace(/^\s+/g,"")},d.trimRight=n.trimRight?function(a){return a.trimRight()}:function(a){return a.replace(/\s+$/g,"")},d.lc=function(a){return a.toString().toLowerCase()},d.uc=function(a){return a.toString().toUpperCase()},d.hasSubString=function(a,b){return a.indexOf(b)>-1},d.each(["Array","Arguments","Boolean","Date","Error","Number","RegExp","String"],function(a){d["is"+a]=function(b){return r(a,b)}}),d.isFunction=c=function(a){return r("Function",a)},d.isObject=b=function(a){var b=typeof a;return"object"===b&&!!a},d.isNaN=function(a){return d.isNumber(a)&&a!==+a},d.isFinite=function(a){return d.isNumber(a)&&isFinite(a)&&!isNaN(a)},d.isUndefined=function(a){return void 0===a},d.isNull=function(a){return null===a},e.isArray&&(d.isArray=e.isArray),d.isArrayLike=function(a){return"object"==typeof a&&isFinite(a.length)},d.toArray=function(a){return d.isArrayLike(a)?p.call(a):[]},d.flatten=function(a){for(var b=[],c=0,e=a.length;e>c;++c)d.isArrayLike(a[c])?b=b.concat(a[c]):b[b.length]=a[c];return b},d.merge=function(a){return(b(a)||c(a))&&d.each(d.toArray(arguments).slice(1),function(c){if(c)for(var e in c)b(c[e])?(a[e]=a[e]||{},d.merge(a[e],c[e])):a[e]=c[e]}),a},d.extend=function(a){return(b(a)||c(a))&&d.each(d.toArray(arguments).slice(1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},d.remove=function(a,b,c){var e,f=a.length;return d.isNumber(b)?(e=a.slice((c||b)+1||f),a.length=0>b?f+b:b,a.push.apply(a,e)):a},d.keys=g.keys?function(a){return g.keys(a)}:function(a){var b=[];return c(a)?d.each(a,function(a,c){c!==d&&b.push(c)}):d.each(a,function(a,c){b.push(c)}),b},d.values=function(a){var b=[];return d.each(a,function(a){b.push(a)}),b},d.hasKey=function(a,b){return a.hasOwnProperty(b)},d.hasValue=function(a,b){return d.indexOf(d.values(a),b)>-1},d.uniq=function(a){var b=[];return d.each(a,function(a){d.hasValue(b,a)||b.push(a)}),b},d.union=function(){var a=[],b=d.toArray(arguments).slice();return d.each(b,function(b){a.concat(b)}),d.uniq(a)},d.bind=l.bind?function(a,b){return a.bind(b,d.toArray(arguments).slice(2))}:function(b,e){if(c(e)&&c(b)){var f=d.toArray(arguments).slice(2),g=function(){},h=function(){return b.apply(this instanceof g&&e?this:e||a,f.concat(arguments))};return g[d]=b[d],h[d]=new g,h}},d.each(["info","log","warn"],function(a){d[a.toUpperCase()]=typeof console===j?q:d.bind(console[a],console)}),d.ERROR=function(a){throw d.WARN(a),new Error(a)},d.getAny=function(a){var b,c;for(b=0;b<a.length;b++)try{c=a[b]();break}catch(d){}return c},d.uuid=function(a){return a=a||"",a+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8,d=c.toString(16);return d})},d.mixin=function(a,b){d.each(a,function(a,c){d[c]&&!b?d.ERROR("P."+c+" already exists"):d[c]=a})},d.setGLOBAL=function(b,c){typeof exports!==j&&(exports[b]=c),a[b]=c},d.each(["P","pastry","PASTRY"],function(a){d.setGLOBAL(a,d)}),typeof exports!==j&&typeof module!==j&&module.exports&&(module.exports=d),d.getGLOBAL=function(b){return a[b]}}(this),function(a){"use strict";var b=a.pastry,c=function(a){a=a||this;var c=a._events={};return a.on=function(b,d,e){var f=c[b]||(c[b]=[]);return f.push({callback:d,context:e}),a},a.off=function(b,d){b||(c={});var e=c[b]||[],f=e.length;if(d)for(;f>0;)f--,e[f].callback===d&&e.splice(f,1);else e=[];return a},a.emit=function(){var d=b.toArray(arguments),e=c[d.shift()]||[];return b.each(e,function(a){a.callback.apply(a.context,d)}),a},a.trigger=a.emit,a};b.mixin({event:c}),c(b)}(this);var define;!function(a,b){"use strict";if(!define){var c,d=a.pastry,e=d.event,f=function(a){var b=this;return b.init(a),b},g=f._data={},h=g.moduleByUri={},i=g.exportsByUri={},j=g.executedByUri={},k=g.queueByUri={};e(f),f.prototype={init:function(a){var b=this;return d.extend(b,a),f.emit("module-inited",b),h[b.uri]=b,h[b.id]=b,k[b.uri]=b,b},processDeps:function(){var a=this;return f.emit("module-depsProcessed",a),a},execute:function(){var a=this,c=[];if("exports"in a)return a;if(d.every(a.deps,function(a){return!!j[a]})){var e=a.factory,g=a.uri,h=a.id;d.each(a.deps,function(a){c.push(i[a])}),a.exports=i[g]=i[h]=d.isFunction(e)?e.apply(b,c):e,j[g]=!0,j[h]=!0,delete k[g],f.emit("module-executed",a)}return a}},f.on("module-executed",function(){d.each(k,function(a){a instanceof f&&a.execute()})}),define=a.define=f.define=function(){var a,c=d.toArray(arguments),e=d.isString(c[0])?c.shift():b,g=c.length>1?c.shift():[],h=c[0],i={id:e,uri:e,deps:g,factory:h};f.emit("module-metaGot",i),a=new f(i).processDeps().execute(),f.emit("module-defined",a)},define.amd={},c=define,define("Module",function(){return f}),define("pastry",function(){return d}),define("event",function(){return e}),d.setGLOBAL("require",c)}}(this),define("fmt/date",["pastry"],function(a){"use strict";function b(a){return 10>a?"0"+a:a}function c(a){var b=a+"",c=b.length;return 3===c?b:2===c?"0"+b:"00"+b}return function(d,e){return a.isDate(d)?(e=e||"{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}Z",e.replace(/\{(\w+)\}/g,function(a,e){var f="get"+("Year"===e?e:"UTC"+e),g=d[f]()+("Month"===e?1:0);return"Milliseconds"===e?c(g):b(g)})):void a.ERROR("not a Date instance")}}),define("fmt/sprintf",["pastry"],function(a){"use strict";function b(a,b){return parseInt(a,b||10)}var c=/%(\+)?([0 ]|'(.))?(-)?([0-9]+)?(\.([0-9]+))?([%bcdfosxX])/g,d=function(d){a.isString(d)||a.ERROR("sprintf: The first arguments need to be a valid format string.");for(var e,f=[],g=1,h=a.toArray(arguments);e=c.exec(d);)g>=h.length&&"%"!==e[8]&&a.ERROR("sprintf: At least one argument was missing."),f[f.length]={begin:e.index,end:e.index+e[0].length,sign:"+"===e[1],negative:parseFloat(h[g])<0?!0:!1,padding:a.isUndefined(e[2])?" ":"'"===e[2].substring(0,1)?e[3]:e[2],alignLeft:"-"===e[4],width:a.isUndefined(e[5])?!1:e[5],precision:a.isUndefined(e[7])?!1:e[7],type:e[8],data:"%"!==e[8]?String(h[g++]):!1};var i,j,k,l,m="",n=0;for(i=0;i<f.length;i++){switch(m+=d.substring(n,f[i].begin),n=f[i].end,k="",f[i].type){case"%":k="%";break;case"b":k=Math.abs(b(f[i].data)).toString(2);break;case"c":k=String.fromCharCode(Math.abs(b(f[i].data)));break;case"d":k=String(Math.abs(b(f[i].data)));break;case"f":k=f[i].precision===!1?String(Math.abs(parseFloat(f[i].data))):Math.abs(parseFloat(f[i].data)).toFixed(f[i].precision);break;case"o":k=Math.abs(b(f[i].data)).toString(8);break;case"s":k=f[i].data.substring(0,f[i].precision?f[i].precision:f[i].data.length);break;case"x":k=Math.abs(b(f[i].data)).toString(16).toLowerCase();break;case"X":k=Math.abs(b(f[i].data)).toString(16).toUpperCase();break;default:a.ERROR('sprintf: Unknown type "'+f[i].type+'" detected. This should never happen. Maybe the regex is wrong.')}if("%"!==f[i].type){if(f[i].width!==!1&&f[i].width>k.length)for(l=k.length,j=0;j<f[i].width-l;++j)k=f[i].alignLeft===!0?k+f[i].padding:f[i].padding+k;("b"===f[i].type||"d"===f[i].type||"o"===f[i].type||"f"===f[i].type||"x"===f[i].type||"X"===f[i].type)&&(f[i].negative===!0?k="-"+k:f[i].sign===!0&&(k="+"+k)),m+=k}else m+=k}return m+=d.substring(n,d.length)};return a.mixin({sprintf:d}),d}),define("fmt/vsprintf",["pastry","fmt/sprintf"],function(a,b){"use strict";var c=function(a,c){return c.unshift(a),b.apply(null,c)};return a.mixin({vsprintf:c}),c}),define("json",["pastry","fmt/date"],function(pastry,fmtDate){"use strict";function exportJSON(a){pastry.mixin({JSON:a}),pastry.setGLOBAL("JSON",a)}function isFunction(a){return pastry.isFunction(a)}function isString(a){return pastry.isString(a)}function isNumber(a){return pastry.isNumber(a)}if(JSON&&JSON.parse&&JSON.stringify)return exportJSON(JSON),JSON;var D2JSON=Date.prototype.toJSON;isFunction(D2JSON)||(pastry.each([String.prototype,Number.prototype,Boolean.prototype],function(a){a.toJSON=function(){return this.valueOf()}}),D2JSON=function(){return isFinite(this.valueOf())?fmtDate(this):null});var undef,escapeString=function(a){return('"'+a.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},shim={parse:function(str,strict){return strict&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(str)&&pastry.ERROR("Invalid characters in JSON"),eval("("+str+")")},stringify:function(a,b,c){function d(a,e,f){b&&(a=b(f,a));var g;if(isNumber(a))return isFinite(a)?a+"":"null";if(pastry.isBoolean(a))return a+"";if(null===a)return"null";if(isString(a))return escapeString(a);if(isFunction(a)||!a)return undef;if(isFunction(a.toJSON))return d(a.toJSON(f),e,f);if(pastry.isDate(a))return fmtDate(a);if(a.valueOf()!==a)return d(a.valueOf(),e,f);var h=c?e+c:"",i=c?" ":"",j=c?"\n":"";if(pastry.isArray(a)){var k=a.length,l=[];for(f=0;k>f;f++){var m=a[f];g=d(m,h,f),isString(g)||(g="null"),l.push(j+h+g)}return"["+l.join(",")+j+e+"]"}var n=[];for(f in a){var o;if(a.hasOwnProperty(f)){if(isNumber(f))o='"'+f+'"';else{if(!isString(f))continue;o=escapeString(f)}if(g=d(a[f],h,f),!isString(g))continue;n.push(j+h+o+":"+i+g)}}return"{"+n.join(",")+j+e+"}"}return isString(b)&&(c=b,b=null),d(a,"","")}};return exportJSON(shim),shim});