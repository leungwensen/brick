!function(a){"use strict";a=a||{};var b={},c=Array,d=Function,e=Object,f=String,g="prototype",h="undefined",i=c[g],j=d[g],k=e[g],l=f[g],m={}.toString,n=i.slice,o=function(){};b.VERSION="0.2.0",b.index=function(a){return function(b,c,d){var e,f=b.length>>>0;if(0===f)return-1;if(d?0>d&&(d=Math.max(0,b.length+d)):d=0,a){for(e=d;e<b.length;e++)if(b[e]===c)return e}else for(e=d;e>=0;e--)if(b[e]===c)return e;return-1}},b.indexOf=i.indexOf?function(a,b,c){return a.indexOf(b,c)}:b.index(!0),b.lastIndexOf=i.lastIndexOf?function(a,b,c){return a.lastIndexOf(b,c)}:b.index(),b.each=b.forEach=k.forEach?function(a,b,c){a.forEach(b,c)}:function(a,b,c){for(var d in a)b.call(c,a[d],d,a)},b.eachReverse=function(a,b,c){if(a)for(var d=a.length-1;d>-1;d-=1)b.call(c,a[d],d,a)},b.every=i.every?function(a,b,c){return a.every(b,c)}:function(a,b,c){var d;for(d=0;d<a.length;d++)if(!b.call(c,a[d],d,a))return!1;return!0},b.filter=i.filter?function(a,b,c){return a.filter(b,c)}:function(a,c,d){var e=[];return b.each(a,function(b,f){c.call(d,b,f,a)&&e.push(b)}),e},b.map=i.map?function(a,b,c){return a.map(b,c)}:function(a,c,d){var e=[];return b.each(a,function(b,f){e.push(c.call(d,b,f,a))}),e},b.some=i.some?function(a,b,c){return a.some(b,c)}:function(a,b,c){var d;for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a))return!0;return!1},b.reduce=i.reduce?function(a,b,c){return c?a.reduce(b,c):a.reduce(b)}:function(a,b,c){var d,e;for(c&&(e=c),d=0;d<a.length;d++)e=e?b(e,a[d],d,a):a[d];return e},b.reduceRight=i.reduceRight?function(a,b,c){return c?a.reduceRight(b,c):a.reduceRight(b)}:function(a,b,c){var d,e;for(c&&(e=c),d=a.length-1;d>=0;d--)e=e?b(e,a[d],d,a):a[d];return e},b.trim=l.trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},b.trimLeft=l.trimLeft?function(a){return a.trimLeft()}:function(a){return a.replace(/^\s+/g,"")},b.trimRight=l.trimRight?function(a){return a.trimRight()}:function(a){return a.replace(/\s+$/g,"")},b.lc=function(a){return a.toString().toLowerCase()},b.uc=function(a){return a.toString().toUpperCase()},b.hasSubString=function(a,b){return a.indexOf(b)>-1},b.each(["Array","Arguments","Boolean","Date","Error","Function","Number","RegExp","String"],function(a){b["is"+a]=function(b){return m.call(b)==="[object "+a+"]"}}),b.isArray=c.isArray?c.isArray:b.isArray,b.isObject=function(a){var b=typeof a;return"object"===b&&!!a},b.isNaN=function(a){return b.isNumber(a)&&a!==+a},b.isFinite=function(a){return b.isNumber(a)&&isFinite(a)&&!isNaN(a)},b.isUndefined=function(a){return void 0===a},b.isNull=function(a){return null===a},b.toArray=function(a){return n.call(a)},b.merge=function(a){return b.isObject(a)&&b.each(b.toArray(arguments).slice(1),function(c){if(c)for(var d in c)b.isObject(c[d])?(a[d]=a[d]||{},b.merge(a[d],c[d])):a[d]=c[d]}),a},b.extend=function(a){return b.isObject(a)&&b.each(b.toArray(arguments).slice(1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},b.remove=function(a,c,d){var e,f=a.length;return b.isNumber(c)?(e=a.slice((d||c)+1||f),a.length=0>c?f+c:c,a.push.apply(a,e)):a},b.keys=e.keys?function(a){return e.keys(a)}:function(a){var c=[];return b.isFunction(a)?b.each(a,function(a,d){d!==b&&c.push(d)}):b.each(a,function(a,b){c.push(b)}),c},b.values=function(a){var c=[];return b.each(a,function(a){c.push(a)}),c},b.hasKey=function(a,b){return a.hasOwnProperty(b)},b.hasValue=function(a,c){return b.indexOf(b.values(a),c)>-1},b.uniq=function(a){var c=[];return b.each(a,function(a){b.hasValue(c,a)||c.push(a)}),c},b.union=function(){var a=[],c=b.toArray(arguments).slice();return b.each(c,function(b){a.concat(b)}),b.uniq(a)},b.bind=j.bind?function(a,c){return a.bind(c,b.toArray(arguments).slice(2))}:function(c,d){if(b.isFunction(d)&&b.isFunction(c)){var e=b.toArray(arguments).slice(2),f=function(){},g=function(){return c.apply(this instanceof f&&d?this:d||a,e.concat(arguments))};return f[b]=c[b],g[b]=new f,g}},b.each(["info","log","warn"],function(a){b[a.toUpperCase()]=typeof console===h?o:b.bind(console[a],console)}),b.ERROR=function(a){throw b.WARN(a),new Error(a)},b.getAny=function(a){var b,c;for(b=0;b<a.length;b++)try{c=a[b]();break}catch(d){}return c},b.uuid=function(a){return a=a||"",a+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8,d=c.toString(16);return d})},b.mixin=function(a,c){b.each(a,function(a,d){b[d]&&!c?b.ERROR("P."+d+" already exists"):b[d]=a})},b.setGLOBAL=function(b,c){typeof exports!==h&&(exports[b]=c),a[b]=c},b.each(["P","pastry","PASTRY"],function(a){b.setGLOBAL(a,b)}),typeof exports!==h&&typeof module!==h&&module.exports&&(module.exports=b),b.getGLOBAL=function(b){return a[b]}}(this),function(a){"use strict";var b=a.pastry,c=function(a){a=a||this;var c=a._events={};return a.on=function(b,d,e){var f=c[b]||(c[b]=[]);return f.push({callback:d,context:e}),a},a.off=function(b,d){b||(c={});var e=c[b]||[],f=e.length;if(d)for(;f>0;)f--,e[f].callback===d&&e.splice(f,1);else e=[];return a},a.emit=function(){var d=b.toArray(arguments),e=c[d.shift()]||[];return b.each(e,function(a){a.callback.apply(a.context,d)}),a},a.trigger=a.emit,a};b.mixin({event:c}),c(b)}(this);var define;!function(a,b){"use strict";if(!define){var c,d=a.pastry,e=d.event,f=function(a){var b=this;return b.init(a),b},g=f._data={},h=g.moduleByUri={},i=g.exportsByUri={},j=g.executedByUri={},k=g.queueByUri={};e(f),f.prototype={init:function(a){var b=this;return d.extend(b,a),f.emit("module-inited",b),h[b.uri]=b,h[b.id]=b,k[b.uri]=b,b},processDeps:function(){var a=this;return f.emit("module-depsProcessed",a),a},execute:function(){var a=this,c=[];if("exports"in a)return a;if(d.every(a.deps,function(a){return!!j[a]})){var e=a.factory,g=a.uri,h=a.id;d.each(a.deps,function(a){c.push(i[a])}),a.exports=i[g]=i[h]=d.isFunction(e)?e.apply(b,c):e,j[g]=!0,j[h]=!0,delete k[g],f.emit("module-executed",a)}return a}},f.on("module-executed",function(){d.each(k,function(a){a instanceof f&&a.execute()})}),define=a.define=f.define=function(){var a,c=d.toArray(arguments),e=d.isString(c[0])?c.shift():b,g=c.length>1?c.shift():[],h=c[0],i={id:e,uri:e,deps:g,factory:h};f.emit("module-metaGot",i),a=new f(i).processDeps().execute(),f.emit("module-defined",a)},define.amd={},c=define,define("Module",function(){return f}),define("pastry",function(){return d}),define("event",function(){return e}),d.setGLOBAL("require",c)}}(this),define("fmt/date",["pastry"],function(a){"use strict";function b(a){return 10>a?"0"+a:a}function c(a){var b=a+"",c=b.length;return 3===c?b:2===c?"0"+b:"00"+b}return function(d,e){return a.isDate(d)?(e=e||"{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}Z",e.replace(/\{(\w+)\}/g,function(a,e){var f="get"+("Year"===e?e:"UTC"+e),g=d[f]()+("Month"===e?1:0);return"Milliseconds"===e?c(g):b(g)})):void a.ERROR("not a Date instance")}}),define("fmt/sprintf",["pastry"],function(a){"use strict";function b(a,b){return parseInt(a,b||10)}var c=/%(\+)?([0 ]|'(.))?(-)?([0-9]+)?(\.([0-9]+))?([%bcdfosxX])/g,d=function(d){a.isString(d)||a.ERROR("sprintf: The first arguments need to be a valid format string.");for(var e,f=[],g=1,h=a.toArray(arguments);e=c.exec(d);)g>=h.length&&"%"!==e[8]&&a.ERROR("sprintf: At least one argument was missing."),f[f.length]={begin:e.index,end:e.index+e[0].length,sign:"+"===e[1],negative:parseFloat(h[g])<0?!0:!1,padding:a.isUndefined(e[2])?" ":"'"===e[2].substring(0,1)?e[3]:e[2],alignLeft:"-"===e[4],width:a.isUndefined(e[5])?!1:e[5],precision:a.isUndefined(e[7])?!1:e[7],type:e[8],data:"%"!==e[8]?String(h[g++]):!1};var i,j,k,l,m="",n=0;for(i=0;i<f.length;i++){switch(m+=d.substring(n,f[i].begin),n=f[i].end,k="",f[i].type){case"%":k="%";break;case"b":k=Math.abs(b(f[i].data)).toString(2);break;case"c":k=String.fromCharCode(Math.abs(b(f[i].data)));break;case"d":k=String(Math.abs(b(f[i].data)));break;case"f":k=f[i].precision===!1?String(Math.abs(parseFloat(f[i].data))):Math.abs(parseFloat(f[i].data)).toFixed(f[i].precision);break;case"o":k=Math.abs(b(f[i].data)).toString(8);break;case"s":k=f[i].data.substring(0,f[i].precision?f[i].precision:f[i].data.length);break;case"x":k=Math.abs(b(f[i].data)).toString(16).toLowerCase();break;case"X":k=Math.abs(b(f[i].data)).toString(16).toUpperCase();break;default:a.ERROR('sprintf: Unknown type "'+f[i].type+'" detected. This should never happen. Maybe the regex is wrong.')}if("%"!==f[i].type){if(f[i].width!==!1&&f[i].width>k.length)for(l=k.length,j=0;j<f[i].width-l;++j)k=f[i].alignLeft===!0?k+f[i].padding:f[i].padding+k;("b"===f[i].type||"d"===f[i].type||"o"===f[i].type||"f"===f[i].type||"x"===f[i].type||"X"===f[i].type)&&(f[i].negative===!0?k="-"+k:f[i].sign===!0&&(k="+"+k)),m+=k}else m+=k}return m+=d.substring(n,d.length)};return a.mixin({sprintf:d}),d}),define("fmt/vsprintf",["pastry","fmt/sprintf"],function(a,b){"use strict";var c=function(a,c){return c.unshift(a),b.apply(null,c)};return a.mixin({vsprintf:c}),c}),define("json",["pastry","fmt/date"],function(pastry,fmtDate){"use strict";function exportJSON(a){pastry.mixin({JSON:a}),pastry.setGLOBAL("JSON",a)}function isFunction(a){return pastry.isFunction(a)}function isString(a){return pastry.isString(a)}function isNumber(a){return pastry.isNumber(a)}if(JSON&&JSON.parse&&JSON.stringify)return exportJSON(JSON),JSON;var D2JSON=Date.prototype.toJSON;isFunction(D2JSON)||(pastry.each([String.prototype,Number.prototype,Boolean.prototype],function(a){a.toJSON=function(){return this.valueOf()}}),D2JSON=function(){return isFinite(this.valueOf())?fmtDate(this):null});var undef,escapeString=function(a){return('"'+a.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},shim={parse:function(str,strict){return strict&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(str)&&pastry.ERROR("Invalid characters in JSON"),eval("("+str+")")},stringify:function(a,b,c){function d(a,e,f){b&&(a=b(f,a));var g;if(isNumber(a))return isFinite(a)?a+"":"null";if(pastry.isBoolean(a))return a+"";if(null===a)return"null";if(isString(a))return escapeString(a);if(isFunction(a)||!a)return undef;if(isFunction(a.toJSON))return d(a.toJSON(f),e,f);if(pastry.isDate(a))return fmtDate(a);if(a.valueOf()!==a)return d(a.valueOf(),e,f);var h=c?e+c:"",i=c?" ":"",j=c?"\n":"";if(pastry.isArray(a)){var k=a.length,l=[];for(f=0;k>f;f++){var m=a[f];g=d(m,h,f),isString(g)||(g="null"),l.push(j+h+g)}return"["+l.join(",")+j+e+"]"}var n=[];for(f in a){var o;if(a.hasOwnProperty(f)){if(isNumber(f))o='"'+f+'"';else{if(!isString(f))continue;o=escapeString(f)}if(g=d(a[f],h,f),!isString(g))continue;n.push(j+h+o+":"+i+g)}}return"{"+n.join(",")+j+e+"}"}return isString(b)&&(c=b,b=null),d(a,"","")}};return exportJSON(shim),shim});