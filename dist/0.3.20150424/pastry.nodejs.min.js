/*! pastry - v0.3.20150424 */!function(a){"use strict";function b(a,b,c){for(var d in a)b.call(c,a[d],d,a)}if(a=a||{},!a.pastry){var c,d,e,f={},g=Array,h=Function,i=Object,j=String,k="prototype",l="undefined",m=g[k],n=h[k],o=j[k],p=function(){},q={}.toString,r=m.slice,s=function(a){return r.call(a,1)},t=function(a,b,c){return a.apply(b,s(c))},u=function(a,b){return q.call(b)==="[object "+a+"]"},v=f.isArrayLike=function(a){return"object"==typeof a&&isFinite(a.length)},w=f.isFunction=function(a){return u("Function",a)},x=f.isNumber=function(a){return u("Number",a)},y=f.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},z=f.isPlainObject=function(a){return u("Object",a)},A=f.toArray=function(a){return v(a)?r.call(a):[]};f.index=function(a){return function(b,c,d){var e,f=b.length>>>0;if(0===f)return-1;if(d?0>d&&(d=Math.max(0,b.length+d)):d=a?0:b.length,a){for(e=d;e<b.length;e++)if(b[e]===c)return e}else for(e=d;e>=0;e--)if(b[e]===c)return e;return-1}},f.indexOf=m.indexOf?function(a){return t(m.indexOf,a,arguments)}:f.index(!0),f.lastIndexOf=m.lastIndexOf?function(a){return t(m.lastIndexOf,a,arguments)}:f.index(),c=f.each=f.forEach=m.forEach?function(a,c,d){return v(a)?t(m.forEach,a,arguments):(z(a)&&b(a,c,d),a)}:function(a,c,d){if(v(a))for(var e=a.length,f=0;e>f;f++)f in a&&c.call(d,a[f],f,a);else z(a)&&b(a,c,d);return a},f.eachReverse=function(a,b,c){if(a)for(var d=a.length-1;d>-1;d-=1)b.call(c,a[d],d,a);return a},f.every=m.every?function(a){return t(m.every,a,arguments)}:function(a,b,c){var d;for(d=0;d<a.length;d++)if(!b.call(c,a[d],d,a))return!1;return!0},f.filter=m.filter?function(a){return t(m.filter,a,arguments)}:function(a,b,d){var e=[];return c(a,function(c,f){b.call(d,c,f,a)&&e.push(c)}),e},f.map=m.map?function(a){return t(m.map,a,arguments)}:function(a,b,d){var e=[];return c(a,function(c,f){e.push(b.call(d,c,f,a))}),e},f.some=m.some?function(a){return t(m.some,a,arguments)}:function(a,b,c){var d;for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a))return!0;return!1},f.reduce=m.reduce?function(a){return t(m.reduce,a,arguments)}:function(a,b,c){var d,e;for(c&&(e=c),d=0;d<a.length;d++)e=e?b(e,a[d],d,a):a[d];return e},f.reduceRight=m.reduceRight?function(a){return t(m.reduceRight,a,arguments)}:function(a,b,c){var d,e;for(c&&(e=c),d=a.length-1;d>=0;d--)e=e?b(e,a[d],d,a):a[d];return e},f.trim=o.trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},f.trimLeft=o.trimLeft?function(a){return a.trimLeft()}:function(a){return a.replace(/^\s+/g,"")},f.trimRight=o.trimRight?function(a){return a.trimRight()}:function(a){return a.replace(/\s+$/g,"")},f.lc=function(a){return(a+"").toLowerCase()},e=f.uc=function(a){return(a+"").toUpperCase()},f.hasSubString=function(a,b){return a.indexOf(b)>-1},f.capitalize=function(a){return a+="",e(a.charAt(0))+a.substr(1)},c(["Array","Arguments","Boolean","Date","Error","RegExp","String"],function(a){f["is"+a]=function(b){return u(a,b)}}),g.isArray&&(f.isArray=g.isArray),f.isNaN=function(a){return x(a)&&a!==+a},f.isFinite=function(a){return x(a)&&isFinite(a)&&!isNaN(a)},f.isUndefined=function(a){return void 0===a},f.isNull=function(a){return null===a},f.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=new Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e},f.flatten=function(a){for(var b=[],c=0,d=a.length;d>c;++c)v(a[c])?b=b.concat(a[c]):b[b.length]=a[c];return b},f.merge=function(a){return c(s(arguments),function(b){if(b)for(var c in b)q.call(b[c])!==q.call(a[c])?a[c]=b[c]:z(b[c])?(a[c]=a[c]||{},f.merge(a[c],b[c])):a[c]=b[c]}),a},f.extend=function(a){return c(s(arguments),function(b){if(b)for(var c in b)a[c]=b[c]}),a},f.remove=function(a,b,c){var d,e=a.length;return x(b)?(d=a.slice((c||b)+1||e),a.length=0>b?e+b:b,a.push.apply(a,d)):a},f.keys=i.keys?function(a){return i.keys(a)}:function(a){var b=[];return w(a)?c(a,function(a,c){c!==k&&b.push(c)}):c(a,function(a,c){b.push(c)}),b},f.invert=function(a){var b={};return c(a,function(a,c){b[a]=c}),b},f.values=function(a){var b=[];return c(a,function(a){b.push(a)}),b},f.hasKey=function(a,b){return a.hasOwnProperty(b)},d=f.hasValue=function(a,b){return f.indexOf(f.values(a),b)>-1},f.uniq=function(a){var b=[];return c(a,function(a){d(b,a)||b.push(a)}),b},f.union=function(){var a=[],b=A(arguments);return c(b,function(b){a.concat(b)}),f.uniq(a)},f.difference=function(a){var b=f.flatten(s(arguments),!0,!0,[]);return f.filter(a,function(a){return!d(b,a)})},f.intersect=function(a,b){var e=[];return c(a,function(a){d(b,a)&&e.push(a)}),e},f.destroy=function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b];a.prototype=a.__proto__=null,a=null},f.clone=function(a){return y(a)?v(a)?A(a):f.extend({},a):a},f.bind=n.bind?function(a){return t(n.bind,a,arguments)}:function(b,c){if(w(c)&&w(b)){var d=A(arguments).slice(2),e=function(){},g=function(){return b.apply(this instanceof e&&c?this:c||a,d.concat(arguments))};return e[f]=b[f],g[f]=new e,g}},c(["info","log","warn"],function(a){f[e(a)]=typeof console===l?p:f.bind(console[a],console)}),f.ERROR=function(a){throw f.WARN(a),new Error(a)},f.getAny=function(a){var b,c;for(b=0;b<a.length;b++)try{c=a[b]();break}catch(d){}return c},f.uuid=function(a){return a=a||"",a+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8,d=c.toString(16);return d})},f.mixin=function(a,b){c(a,function(a,c){f[c]&&!b?f.ERROR("pastry."+c+" already exists"):f[c]=a})},f.setGLOBAL=function(b,c){typeof exports!==l&&(exports[b]=c),a[b]=c},c(["P","pastry","PASTRY"],function(a){f.setGLOBAL(a,f)}),typeof exports!==l&&typeof module!==l&&module.exports&&(module.exports=f)}}(this),function(a){"use strict";var b=a.pastry,c=function(a){a=a||this;var c=a._events={};return a.on=function(b,d,e){var f=c[b]||(c[b]=[]);return f.push({callback:d,context:e}),a},a.off=function(b,d){b||(c={});var e=c[b]||[],f=e.length;if(d)for(;f>0;)f--,e[f].callback===d&&e.splice(f,1);else e=[];return a},a.emit=function(){var d=b.toArray(arguments),e=c[d.shift()]||[];return b.each(e,function(a){a.callback||(b.LOG(a,e),b.ERROR("event callback is not defined")),a.callback.apply(a.context,d)}),a},a.trigger=a.emit,a};c(b),b.event=c}(this);var define;!function(a,b){"use strict";if(!define){var c,d=a.pastry,e=d.event,f=d.each,g=function(a){var b=this;return b.initialise(a),b},h=g._data={},i=h.moduleByUri={},j=h.exportsByUri={},k=h.executedByUri={},l=h.queueByUri={};e(g),g.prototype={initialise:function(a){var b,c,e,f=this;return d.extend(f,a),g.emit("module-initialised",f),(c=f.uri)&&(i[c]||(i[c]=f),l[c]||(l[c]=f)),(b=f.id)&&(i[b]||(i[b]=f)),(e=f.relativeUri)&&(i[e]||(i[e]=f),l[e]||(l[f.relativeUri]=f)),f},processDeps:function(){var a=this;return g.emit("module-depsProcessed",a),a},execute:function(){var a=this,c=[];if("exports"in a)return delete l[a.uri],delete l[a.relativeUri],a;if(d.every(a.deps,function(a){return!!k[a]})){var e=a.factory,h=a.uri,i=a.id,m=a.relativeUri;f(a.deps,function(a){c.push(j[a])}),a.exports=j[h]=j[i]=j[m]=d.isFunction(e)?e.apply(b,c):e,k[h]=k[i]=k[m]=!0,delete l[h],g.emit("module-executed",a)}return a}},g.on("module-executed",function(){f(l,function(a){a instanceof g&&a.execute()})}),define=a.define=g.define=function(){var a,c=d.toArray(arguments),e=d.isString(c[0])?c.shift():b,f=c.length>1?c.shift():[],h=c[0],i={id:e,uri:e,deps:f,factory:h};g.emit("module-metaGot",i),a=new g(i).processDeps().execute(),g.emit("module-defined",a)},define.amd={},c=define,define("pastry/Module",function(){return g}),define("pastry/pastry",function(){return d}),define("pastry/event/event",function(){return d.event}),d.setGLOBAL("require",c)}}(this),define("pastry/fmt/sprintf",["pastry/pastry"],function(a){"use strict";function b(a,b){return parseInt(a,b||10)}var c=/%(\+)?([0 ]|'(.))?(-)?([0-9]+)?(\.([0-9]+))?([%bcdfosxX])/g,d=function(d){a.isString(d)||a.ERROR("sprintf: The first arguments need to be a valid format string.");for(var e,f=[],g=1,h=a.toArray(arguments);e=c.exec(d);)g>=h.length&&"%"!==e[8]&&a.ERROR("sprintf: At least one argument was missing."),f[f.length]={begin:e.index,end:e.index+e[0].length,sign:"+"===e[1],negative:parseFloat(h[g])<0?!0:!1,padding:a.isUndefined(e[2])?" ":"'"===e[2].substring(0,1)?e[3]:e[2],alignLeft:"-"===e[4],width:a.isUndefined(e[5])?!1:e[5],precision:a.isUndefined(e[7])?!1:e[7],type:e[8],data:"%"!==e[8]?String(h[g++]):!1};var i,j,k,l,m="",n=0;for(i=0;i<f.length;i++){switch(m+=d.substring(n,f[i].begin),n=f[i].end,k="",f[i].type){case"%":k="%";break;case"b":k=Math.abs(b(f[i].data)).toString(2);break;case"c":k=String.fromCharCode(Math.abs(b(f[i].data)));break;case"d":k=String(Math.abs(b(f[i].data)));break;case"f":k=f[i].precision===!1?String(Math.abs(parseFloat(f[i].data))):Math.abs(parseFloat(f[i].data)).toFixed(f[i].precision);break;case"o":k=Math.abs(b(f[i].data)).toString(8);break;case"s":k=f[i].data.substring(0,f[i].precision?f[i].precision:f[i].data.length);break;case"x":k=Math.abs(b(f[i].data)).toString(16).toLowerCase();break;case"X":k=Math.abs(b(f[i].data)).toString(16).toUpperCase();break;default:a.ERROR('sprintf: Unknown type "'+f[i].type+'" detected. This should never happen. Maybe the regex is wrong.')}if("%"!==f[i].type){if(f[i].width!==!1&&f[i].width>k.length)for(l=k.length,j=0;j<f[i].width-l;++j)k=f[i].alignLeft===!0?k+f[i].padding:f[i].padding+k;("b"===f[i].type||"d"===f[i].type||"o"===f[i].type||"f"===f[i].type||"x"===f[i].type||"X"===f[i].type)&&(f[i].negative===!0?k="-"+k:f[i].sign===!0&&(k="+"+k)),m+=k}else m+=k}return m+=d.substring(n,d.length)};return a.sprintf=d}),define("pastry/fmt/vsprintf",["pastry/pastry","pastry/fmt/sprintf"],function(a,b){"use strict";var c=function(a,c){return c.unshift(a),b.apply(null,c)};return a.vsprintf=c}),define("pastry/fmt/camelCase",["pastry/pastry"],function(a){"use strict";function b(b){return b.replace(/^[_.\- ]+/,"").replace(/[_.-](\w|$)/g,function(b,c){return a.uc(c)})}function c(b,c){return c=c||"_",b.replace(/([a-z])([A-Z])/g,function(b,d,e){return d+c+a.lc(e)})}function d(e,f,g){return e&&a.isObject(e)?!e||a.isDate(e)||a.isRegExp(e)?e:a.isArray(e)?a.map(e,function(a){return d(a,f,g)}):a.reduce(a.keys(e),function(a,h){var i=f?c(h,g):b(h);return a[i]=d(e[h],f,g),a},{}):e}return a.camelCase={camelise:function(c){return a.isString(c)?b(c):a.isObject(c)?d(c):c},uncamelise:function(b,e){return a.isString(b)?c(b,e):a.isObject(b)?d(b,!0,e):b}}}),define("pastry/color/hexByName",[],function(){"use strict";var a={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",burntsienna:"#ea7e5d",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return a}),define("pastry/oop/c3mro",["pastry/pastry"],function(a){"use strict";function b(a){return a.slice(0)}function c(b,c){var d=!0;return a.some(c,function(a){e(a,b)>0&&(d=!1)}),d&&a.each(c,function(a){0===e(a,b)&&a.shift()}),d}function d(b){for(var d=[],e=0;b.length;){var f=b.shift();f.length&&(c(f[0],b)?(d.push(f.shift()),e=0):(e+=1,e===b.length&&a.ERROR("Bad Linearization")),f.length&&b.push(f))}return d}var e=a.indexOf;return a.c3mroMerge=function(){var c=a.map(a.toArray(arguments),b);return d(c)}}),define("pastry/oop/declare",["pastry/pastry","pastry/oop/c3mro"],function(a,b){"use strict";return a.declare=function(){var c,d,e="_linearization",f=a.toArray(arguments),g=a.isString(f[0])?f.shift():"",h=f.length>1?f.shift():[],i=f[0]?f.shift():{},j=[],k=function(){},l=!1,m=function(){};for(h=a.isArray(h)?h:[h],a.each(h,function(a){a[e]=a[e]||[a],j.push(a[e])}),j.length&&(j.push(h),j=b.apply(null,j)),d=i.constructor,d!==Object.prototype.constructor&&(l=!0,m=d),m[e]=[m].concat(j),m.parents=j.slice(0),i.constructor=m;c=j.shift();)i=a.extend({},c.prototype,i),k.prototype=i,l||(i.constructor=m),i=new k;return m.className=g,m.prototype=i,m.prototype.constructor=m,m}}),define("pastry/color/Color",["pastry/pastry","pastry/color/hexByName","pastry/oop/declare"],function(a,b,c){"use strict";function d(b,c,d){return b=Number(b),a.isFinite(b)?c>b?c:b>d?d:b:d}function e(a,b,c){0>c&&++c,c>1&&--c;var d=6*c;return 1>d?a+(b-a)*d:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}function f(a,b,c,d){var e,f,g=Math.max(a,b,c),h=Math.min(a,b,c),i=(g+h)/2;if(g===h)e=f=0;else{var j=g-h;switch(f=i>.5?j/(2-g-h):j/(g+h),g){case a:e=(b-c)/j+(c>b?6:0);break;case b:e=(c-a)/j+2;break;case c:e=(a-b)/j+4}e/=6}return[e,f,i,d]}var g,h=a.lc,i=Math.round,j={r:255,g:255,b:255,a:1},k=function(a){var b=this;a&&b.initialise(a)};return a.extend(k,{hexByName:b,makeGrey:function(a,b){return k.fromArray([a,a,a,b])},blendColors:function(b,c,d,e){var f=e||new k;return a.each(["r","g","b","a"],function(a){f[a]=b[a]+(c[a]-b[a])*d,"a"!==a&&(f[a]=Math.round(f[a]))}),f.sanitize()},fromHex:function(b,c){var d=c||new k,e=4===b.length?4:8,f=(1<<e)-1;return b=Number("0x"+b.substr(1)),a.isNaN(b)?null:(a.each(["b","g","r"],function(a){var c=b&f;b>>=e,d[a]=4===e?17*c:c}),d.a=1,d)},fromRgb:function(a,b){var c=h(a).match(/^rgba?\(([\s\.,0-9]+)\)/);return c&&k.fromArray(c[1].split(/\s*,\s*/),b)},fromHsl:function(a,b){var c=h(a).match(/^hsla?\(([\s\.,0-9]+)\)/);if(c){var d=c[2].split(/\s*,\s*/),f=d.length,g=(parseFloat(d[0])%360+360)%360/360,i=parseFloat(d[1])/100,j=parseFloat(d[2])/100,l=.5>=j?j*(i+1):j+i-j*i,m=2*j-l,n=[256*e(m,l,g+1/3),256*e(m,l,g),256*e(m,l,g-1/3),1];return 4===f&&(n[3]=d[3]),k.fromArray(n,b)}},fromArray:function(a,b){var c=b||new k;return c.set(Number(a[0]),Number(a[1]),Number(a[2]),Number(a[3])),isNaN(c.a)&&(c.a=1),c.sanitize()},fromString:function(a,b){var c=k.hexByName[a];return c&&k.fromHex(c,b)||k.fromRgb(a,b)||k.fromHex(a,b)||k.fromHsl(a,b)}}),g=a.extend(j,{constructor:k,initialise:function(b){var c=this;return a.isString(b)?k.fromString(b,this):a.isArray(b)?k.fromArray(b,this):(c.set(b.r,b.g,b.b,b.a),b instanceof k||c.sanitize()),c},set:function(a,b,c,d){var e=this;return e.r=a,e.g=b,e.b=c,e.a=d,e},sanitize:function(){var a=this;return a.r=i(d(a.r,0,255)),a.g=i(d(a.g,0,255)),a.b=i(d(a.b,0,255)),a.a=d(a.a,0,1),a},toRgba:function(){var a=this;return[a.r,a.g,a.b,a.a]},toHsla:function(){var a=this;return f(a.r,a.g,a.b,a.a)},toHex:function(){var b=this,c=a.map(["r","g","b"],function(a){var c=b[a].toString(16);return c.length<2?"0"+c:c});return"#"+c.join("")},toCss:function(a){var b=this,c=b.r+", "+b.g+", "+b.b;return(a?"rgba("+c+","+b.a:"rgb("+c)+")"},toString:function(){return this.toCss(!0)},toGrey:function(){var a=this,b=i((a.r+a.g+a.b)/3);return k.makeGrey(b,a.a)},destroy:function(){a.destroy(this)}}),a.Color=c("pastry/color/Color",g)}),define("pastry/fmt/date",["pastry/pastry"],function(a){"use strict";function b(a){return 10>a?"0"+a:a}function c(a){var b=a+"",c=b.length;return 3===c?b:2===c?"0"+b:"00"+b}return a.fmtDate=function(d,e){return a.isDate(d)?(e=e||"{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}Z",e.replace(/\{(\w+)\}/g,function(a,e){var f="get"+("Year"===e?e:"UTC"+e),g=d[f]()+("Month"===e?1:0);return"Milliseconds"===e?c(g):b(g)})):void a.ERROR("not a Date instance")}}),define("pastry/encoding/json",["pastry/pastry","pastry/fmt/date"],function(pastry,fmtDate){"use strict";function exportJSON(a){return pastry.json=a,pastry.setGLOBAL("JSON",a),a}if("undefined"!=typeof JSON&&JSON&&JSON.parse&&JSON.stringify)return exportJSON(JSON);var D2JSON=Date.prototype.toJSON,isFunction=pastry.isFunction,isString=pastry.isString,isNumber=pastry.isNumber;isFunction(D2JSON)||(pastry.each([String.prototype,Number.prototype,Boolean.prototype],function(a){a.toJSON=function(){return this.valueOf()}}),D2JSON=function(){return isFinite(this.valueOf())?fmtDate(this):null});var undef,escapeString=function(a){return('"'+a.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},shim={parse:function(str,strict){return strict&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(str)&&pastry.ERROR("Invalid characters in JSON"),eval("("+str+")")},stringify:function(a,b,c){function d(a,e,f){b&&(a=b(f,a));var g;if(isNumber(a))return isFinite(a)?a+"":"null";if(pastry.isBoolean(a))return a+"";if(null===a)return"null";if(isString(a))return escapeString(a);if(isFunction(a)||!a)return undef;if(isFunction(a.toJSON))return d(a.toJSON(f),e,f);if(pastry.isDate(a))return fmtDate(a);if(a.valueOf()!==a)return d(a.valueOf(),e,f);var h=c?e+c:"",i=c?" ":"",j=c?"\n":"";if(pastry.isArray(a)){var k=a.length,l=[];for(f=0;k>f;f++){var m=a[f];g=d(m,h,f),isString(g)||(g="null"),l.push(j+h+g)}return"["+l.join(",")+j+e+"]"}var n=[];for(f in a){var o;if(a.hasOwnProperty(f)){if(isNumber(f))o='"'+f+'"';else{if(!isString(f))continue;o=escapeString(f)}if(g=d(a[f],h,f),!isString(g))continue;n.push(j+h+o+":"+i+g)}}return"{"+n.join(",")+j+e+"}"}return isString(b)&&(c=b,b=null),d(a,"","")}};return exportJSON(shim)}),define("pastry/html/escape",["pastry/pastry"],function(a){"use strict";function b(b){function c(a){return b[a]}var d="(?:"+a.keys(b).join("|")+")",e=new RegExp(d),f=new RegExp(d,"g");return function(a){return a=null===a?"":""+a,e.test(a)?a.replace(f,c):a}}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},d=a.invert(c);return{escape:a.escape=b(c),unescape:a.unescape=b(d)}}),define("pastry/text/template",["pastry/pastry","pastry/html/escape"],function(a,b){"use strict";function c(a,b,c,d,e,f,g){return b?{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[b]||"\\"+b:c?(d=h(d),"="===c?"'+_e("+d+")+'":"'+("+d+"==null?'':"+d+")+'"):e&&f&&g?"';"+h(f)+" _s+='":void 0}function d(a){return a.replace(i,c).replace(/\\n\s*/g,"")}var e,f={},g={},h=a.trim,i=/([\s'\\])(?!(?:[^{]|\{(?!%))*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(?:(\{%)([\s\S]+?)(%\}))/g;return a.extend(g,b),a.template=e={helper:g,parse:d,compile:function(b){return a.isString(b)?f[b]||(f[b]=new Function("obj","helper","ne","var _e=ne?function(s){return s;}:helper.escape,print=function(s,e){_s+=e?(s==null?'':s):_e(s);};obj=obj||{};with(obj){_s='"+d(b)+"';}return _s;")):b},render:function(a,b,c){return c=c||{},e.compile(a)(b,e.helper,c.ne)}}}),define("pastry/promise/Promise",["pastry/pastry","pastry/oop/declare"],function(a,b){"use strict";function c(b){return a.Promise=b,a.setGLOBAL("Promise",b),b}function d(a){var b=this;if(!h(a))throw new TypeError("Promise resolver "+a+" is not a function");var c=b._resolver=new j;try{a(function(a){c.resolve(a)},function(a){c.reject(a)})}catch(d){c.reject(d)}}if("undefined"!=typeof Promise&&Promise&&Promise.resolve)return c(Promise);var e=a.extend,f=a.each,g=a.isArray,h=a.isFunction,i=a.isObject,j=b("pastry/promise/Resolver",[],{constructor:function(){e(this,{_callbacks:[],_errbacks:[],_status:"pending",_result:null})},fulfill:function(a){var b=this,c=b._status;("pending"===c||"accepted"===c)&&(b._result=a,b._status="fulfilled"),"fulfilled"===b._status&&(b._notify(b._callbacks,b._result),b._callbacks=[],b._errbacks=null)},reject:function(a){var b=this,c=b._status;("pending"===c||"accepted"===c)&&(b._result=a,b._status="rejected"),"rejected"===b._status&&(b._notify(b._errbacks,b._result),b._callbacks=null,b._errbacks=[])},resolve:function(a){var b=this;"pending"===b._status&&(b._status="accepted",b._value=a,(b._callbacks&&b._callbacks.length||b._errbacks&&b._errbacks.length)&&b._unwrap(b._value))},_unwrap:function(a){var b,c=this,d=!1;if(!a||!i(a)&&!h(a))return void c.fulfill(a);try{b=a.then,h(b)?b.call(a,function(a){d||(d=!0,c._unwrap(a))},function(a){d||(d=!0,c.reject(a))}):c.fulfill(a)}catch(e){d||c.reject(e)}},_addCallbacks:function(a,b){var c=this,d=c._callbacks,e=c._errbacks;switch(d&&d.push(a),e&&e.push(b),c._status){case"accepted":c._unwrap(c._value);break;case"fulfilled":c.fulfill(c._result);break;case"rejected":c.reject(c._result)}},_notify:function(a,b){a.length&&d.async(function(){f(a,function(a){a(b)})})}});return a.extend(d,{Resolver:j,resolve:function(a){return a&&a.constructor===this?a:new this(function(b){b(a)})},reject:function(a){var b=new this(function(){});return b._resolver._result=a,b._resolver._status="rejected",b},all:function(a){return new d(function(b,c){function e(a){return function(c){j[a]=c,f--,f||b(j)}}if(!g(a))return void c(new TypeError("Promise.all expects an array of values or promises"));var f=a.length,h=0,i=a.length,j=[];if(1>i)return b(j);for(;i>h;h++)d.resolve(a[h]).then(e(h),c)})},race:function(a){return new d(function(b,c){return g(a)?void f(a,function(a){d.resolve(a).then(b,c)}):void c(new TypeError("Promise.race expects an array of values or promises"))})},async:a.getAny([function(){return setImmediate?function(a){setImmediate(a)}:void 0},function(){return process.nextTick},function(){return function(a){setTimeout(a,0)}}]),_makeCallback:function(a,b,c,d){return function(e){var f;try{f=d(e)}catch(g){return void c(g)}return f===a?void c(new TypeError("Cannot resolve a promise with itself")):void b(f)}}}),c(b("pastry/promise/Promise",[],{constructor:d,then:function(a,b){var c,e,f=new d(function(a,b){c=a,e=b});return this._resolver._addCallbacks(h(a)?d._makeCallback(f,c,e,a):c,h(b)?d._makeCallback(f,c,e,b):e),f},"catch":function(a){return this.then(void 0,a)}}))}),define("all-nodejs-modules",["pastry/fmt/vsprintf","pastry/fmt/camelCase","pastry/color/Color","pastry/encoding/json","pastry/text/template","pastry/oop/declare","pastry/html/escape","pastry/promise/Promise"],function(){});